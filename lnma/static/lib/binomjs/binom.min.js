(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Binom=f()}})(function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){(function(root,factory){if(typeof define==="function"&&define.amd){define([],factory)}else if(typeof exports==="object"){module.exports=factory()}else{root.Binom=factory()}})(this,function(){function getPValue(z){var Z_MAX=6;var w,x,y;if(z===0){x=0}else{y=.5*Math.abs(z);if(y>Z_MAX*.5){x=1}else if(y<1){w=y*y;x=((((((((.000124818987*w-.001075204047)*w+.005198775019)*w-.019198292004)*w+.059054035642)*w-.151968751364)*w+.319152932694)*w-.5319230073)*w+.797884560593)*y*2}else{y-=2;x=(((((((((((((-45255659e-12*y+.00015252929)*y-19538132e-12)*y-.000676904986)*y+.001390604284)*y-.00079462082)*y-.002034254874)*y+.006549791214)*y-.010557625006)*y+.011630447319)*y-.009279453341)*y+.005353579108)*y-.002141268741)*y+.000535310849)*y+.999936657524}}return(1-x)/2}var Binom=function(){};Binom.prototype.test=function(trialsNum,successesNum,hypothesisTrialsNum,hypothesisSuccessesNum,confidenceRate){var Confidence=require("confidencejs");var confidence=new Confidence;confidence.addVariant({id:"A",name:"Hypothesis Data",conversionCount:hypothesisSuccessesNum,eventCount:hypothesisTrialsNum});confidence.addVariant({id:"B",name:"Test Data",conversionCount:successesNum,eventCount:trialsNum});var confidenceTestResult=confidence.getResult();var averageSuccessRate,minSuccessRate,maxSuccessRate;var pValue=getPValue(confidence._zScore);var testResult;var error;if(confidenceTestResult.hasWinner){minSuccessRate=confidenceTestResult.confidenceInterval.min/100;maxSuccessRate=confidenceTestResult.confidenceInterval.max/100;averageSuccessRate=confidenceTestResult.winnerID=="B"?successesNum/trialsNum:hypothesisSuccessesNum/hypothesisTrialsNum}else{error=confidenceTestResult.readable}if((1-confidenceRate)/2>=pValue&&confidenceTestResult.winnerID=="B"){testResult=true}else{testResult=false}return{averageSuccessRate:averageSuccessRate,minSuccessRate:minSuccessRate,maxSuccessRate:maxSuccessRate,pValue:pValue,testResult:testResult,error:error}};return Binom})},{confidencejs:2}],2:[function(require,module,exports){(function(root,factory){if(typeof define==="function"&&define.amd){define([],factory)}else if(typeof exports==="object"){module.exports=factory()}else{root.Confidence=factory()}})(this,function(){var DEFAULT_Z_SCORE=1.96;var DEFAULT_MARGIN_OF_ERROR=.01;var VERSION="1.1.0";var Confidence=function(settings){settings=settings||{};this._zScore=settings.hasOwnProperty("zScore")?settings.zScore:DEFAULT_Z_SCORE;this._marginOfError=settings.hasOwnProperty("marginOfError")?settings.marginOfError:DEFAULT_MARGIN_OF_ERROR;this._variants={};this._confidenceIntervals={}};Confidence.version=VERSION;var Z_MAX=6;var zScoreProbability=function(z){var w,x,y;if(z===0){x=0}else{y=.5*Math.abs(z);if(y>Z_MAX*.5){x=1}else if(y<1){w=y*y;x=((((((((.000124818987*w-.001075204047)*w+.005198775019)*w-.019198292004)*w+.059054035642)*w-.151968751364)*w+.319152932694)*w-.5319230073)*w+.797884560593)*y*2}else{y-=2;x=(((((((((((((-45255659e-12*y+.00015252929)*y-19538132e-12)*y-.000676904986)*y+.001390604284)*y-.00079462082)*y-.002034254874)*y+.006549791214)*y-.010557625006)*y+.011630447319)*y-.009279453341)*y+.005353579108)*y-.002141268741)*y+.000535310849)*y+.999936657524}}if(z>0){return(x+1)/2}else{return(1-x)/2}};var BIGX=20;function ex(x){return x<-BIGX?0:Math.exp(x)}var pochisq=function(x,df){var a,y,s;var e,c,z;var even;var LOG_SQRT_PI=.5723649429247001;var I_SQRT_PI=.5641895835477563;if(x<=0||df<1){return 1}a=.5*x;even=!(df&1);if(df>1){y=ex(-a)}s=even?y:2*zSquareProbability(-Math.sqrt(x));if(df>2){x=.5*(df-1);z=even?1:.5;if(a>BIGX){e=even?0:LOG_SQRT_PI;c=Math.log(a);while(z<=x){e=Math.log(z)+e;s+=ex(c*z-a-e);z+=1}return s}else{e=even?1:I_SQRT_PI/Math.sqrt(a);c=0;while(z<=x){e=e*(a/z);c=c+e;z+=1}return c*y+s}}else{return s}};var critchi=function(p,df){var CHI_EPSILON=1e-6;var CHI_MAX=99999;var minchisq=0;var maxchisq=CHI_MAX;var chisqval;if(p<=0){return maxchisq}else{if(p>=1){return 0}}chisqval=df/Math.sqrt(p);while(maxchisq-minchisq>CHI_EPSILON){if(pochisq(chisqval,df)<p){maxchisq=chisqval}else{minchisq=chisqval}chisqval=(maxchisq+minchisq)*.5}return chisqval};Confidence.prototype.addVariant=function(variant){if(this.variantExists(variant.id)){var message="A variant with ID '"+variant.id+"' already exists.";throw new Error(message)}else{if(variant.hasOwnProperty("id")&&variant.hasOwnProperty("conversionCount")&&variant.hasOwnProperty("eventCount")){if(!variant.hasOwnProperty("name")){variant["name"]="Variant "+variant.id}this._variants[variant.id]=variant}else{throw new Error("variant object needs conversionCount and eventCount properties")}}};Confidence.prototype.getVariant=function(variantID){if(this.variantExists(variantID)){return this._variants[variantID]}else{throw new Error("The variant you requested does not exist.")}};Confidence.prototype.variantExists=function(variantID){if(this._variants.hasOwnProperty(variantID)){return true}else{return false}};Confidence.prototype.hasVariants=function(variants){for(var variant in variants){if(variants.hasOwnProperty(variant)){return true}}return false};Confidence.prototype.getResult=function(){if(this.hasVariants(this._variants)){confidenceIntervals={};var result;for(var variantID in this._variants){var requiredSampleSize=this.getRequiredSampleSize(variantID);var hasWinner=false;var hasEnoughData=this.hasEnoughData(variantID);if(!hasEnoughData){result={hasWinner:hasWinner,hasEnoughData:hasEnoughData,winnerID:null,winnerName:null,confidencePercent:null,confidenceInterval:null,readable:"There is not enough data to determine a conclusive result."};return result}var confidenceInterval=this.getConfidenceInterval(variantID);confidenceIntervals[variantID]=confidenceInterval}result=this.analyzeConfidenceIntervals(confidenceIntervals);return result}else{throw new Error("There are no variants available.")}};Confidence.prototype.analyzeConfidenceIntervals=function(confidenceIntervals){var minimums=[];var maximums=[];for(var id in confidenceIntervals){var min=confidenceIntervals[id].min;minimums.push({id:id,val:min});var max=confidenceIntervals[id].max;maximums.push({id:id,val:max})}minimums=this.sortList(minimums);var idWithLargestMin=minimums[0].id;var largestMin=minimums[0].val;maximums=this.sortList(maximums);for(var index=0;index<maximums.length;index++){var obj=maximums[index];if(obj.id==idWithLargestMin){maximums.splice(index,1)}}var idWithLargestMax=maximums[0].id;var largestMax=maximums[0].val;var confidencePercent=this.getConfidencePercent();var result;var hasWinner;var hasEnoughData;if(largestMin>largestMax){winningVariantName=this._variants[idWithLargestMin].name;var roundedMin=Math.round(1e4*confidenceIntervals[idWithLargestMin].min)/100;var roundedMax=Math.round(1e4*confidenceIntervals[idWithLargestMin].max)/100;var message="With "+confidencePercent+'% confidence, the true population parameter of the "';message+=winningVariantName+'" variant will fall between ';message+=roundedMin+"% and ";message+=roundedMax+"%.";result={hasWinner:true,hasEnoughData:true,winnerID:idWithLargestMin,winnerName:winningVariantName,confidencePercent:confidencePercent,confidenceInterval:{min:roundedMin,max:roundedMax},readable:message};return result}else{var messageNoWinner="There is no winner, the results are too close.";result={hasWinner:false,hasEnoughData:true,winnerID:null,winnerName:null,confidencePercent:confidencePercent,confidenceInterval:null,readable:messageNoWinner}}return result};Confidence.prototype.sortList=function(list){list.sort(function(a,b){return b.val-a.val});return list};Confidence.prototype.getConfidencePercent=function(zScore){zScore=typeof zScore==="number"?zScore:this._zScore;var normalProbability=zScoreProbability(zScore);return(100*(2*normalProbability-1)).toFixed(2)};Confidence.prototype.getRequiredSampleSize=function(variantID){var standardError=this.getStandardError(variantID);var numerator=Math.pow(this._zScore,2)*standardError*(1-standardError);var denominator=Math.pow(this._marginOfError,2);var requiredSampleSize=Math.max(numerator/denominator,100);return requiredSampleSize};Confidence.prototype.hasEnoughData=function(variantID){var variant=this.getVariant(variantID);var requiredSampleSize=this.getRequiredSampleSize(variantID);if(variant.eventCount>=requiredSampleSize){return true}else{return false}};Confidence.prototype.getRate=function(variantID){var variant=this.getVariant(variantID);if(variant.eventCount===0){throw new Error("Total is zero: cannot divide by zero to produce rate.")}else if(variant.eventCount<0){throw new Error("Total is negative: cannot use a negative number to produce rate.")}else{var rate=variant.conversionCount/variant.eventCount;return rate}};Confidence.prototype.getConfidenceInterval=function(variantID){var confidenceInterval={};var rate=this.getRate(variantID);var standardError=this.getStandardError(variantID);var min=rate-this._zScore*standardError;if(min<0){min=0}var max=rate+this._zScore*standardError;if(max>1){max=1}confidenceInterval={min:min,max:max};return confidenceInterval};Confidence.prototype.getStandardError=function(variantID){var variant=this.getVariant(variantID);var rate=this.getRate(variantID);var standardError=Math.sqrt(rate*(1-rate)/variant.eventCount);return standardError};Confidence.prototype.getMarascuilloResult=function(){var result;var observedValues=this.getObservedValues();var pooledProportion=this.getPooledProportion(observedValues);var expectedValues=this.getExpectedValues(observedValues,pooledProportion);if(expectedValues.hasEnoughData===false){result={hasWinner:false,hasEnoughData:false,winnerID:null,winnerName:null};return result}var chiPartValues=this.getChiParts(observedValues,expectedValues);var chiPartSum=this.sumChiParts(chiPartValues);var degreesOfFreedom=this.getDegreesOfFreedom();var probability=1-zScoreProbability(this._zScore);var critChi=critchi(probability,2);if(chiPartSum>critChi){var bestVariant=this.getBestVariant();result=this.marascuilo(bestVariant,critChi)}else{result={hasWinner:false,hasEnoughData:true,winnerID:null,winnerName:null};return result}return result};Confidence.prototype.getObservedValues=function(){var observedValues={};var variants=this._variants;for(var variant in variants){var observedStats={};var success=variants[variant].conversionCount;var fail=variants[variant].eventCount-variants[variant].conversionCount;var total=variants[variant].eventCount;observedStats["success"]=success;observedStats["fail"]=fail;observedStats["total"]=total;observedValues[variant]=observedStats}return observedValues};Confidence.prototype.getPooledProportion=function(observedValues){var summedSuccesses=0;var summedTotals=0;for(var variant in observedValues){summedSuccesses+=observedValues[variant].success;summedTotals+=observedValues[variant].total}if(summedTotals===0){throw new Error("Summed total is zero: cannot divide by zero to produce rate.")}else{var result=summedSuccesses/summedTotals;return result}};Confidence.prototype.getExpectedValues=function(observedValues,pooledProportion){var expectedValues={};for(var variant in observedValues){var expectedStats={};var success;var fail;success=pooledProportion*observedValues[variant].total;fail=(1-pooledProportion)*observedValues[variant].total;if(success<5||fail<5){expectedValues["hasEnoughData"]=false}expectedStats["success"]=success;expectedStats["fail"]=fail;expectedValues[variant]=expectedStats}if(expectedValues["hasEnoughData"]!==false){expectedValues["hasEnoughData"]=true}return expectedValues};Confidence.prototype.getChiParts=function(observedValues,expectedValues){var chiPartValues={};var success;var fail;for(var variant in observedValues){var chiPartStats={};var observedSuccess=observedValues[variant].success;var expectedSuccess=expectedValues[variant].success;if(expectedSuccess===0){throw new Error("Cannot divide by zero to produce chi parts.")}else{success=Math.pow(observedSuccess-expectedSuccess,2)/expectedSuccess;chiPartStats["success"]=success}var observedFail=observedValues[variant].fail;var expectedFail=expectedValues[variant].fail;if(expectedFail===0){throw new Error("Cannot divide by zero to produce chi parts.")}else{fail=Math.pow(observedFail-expectedFail,2)/expectedFail;chiPartStats["fail"]=fail}chiPartValues[variant]=chiPartStats}return chiPartValues};Confidence.prototype.sumChiParts=function(chiPartValues){var chiPartSum=0;for(var variant in chiPartValues){chiPartSum+=chiPartValues[variant].success;chiPartSum+=chiPartValues[variant].fail}return chiPartSum};Confidence.prototype.getDegreesOfFreedom=function(){var len=Object.keys(this._variants).length-1;return len};Confidence.prototype.getBestVariant=function(){var bestRate=0;var bestVariantID;for(var variantID in this._variants){var rate=this.getRate(variantID);if(rate>bestRate){bestRate=rate;bestVariantID=variantID}}return bestVariantID};Confidence.prototype.marascuillo=function(bestVariantID,critChi){var result;for(var variantID in this._variants){if(variantID===bestVariantID){continue}else{var testStatistic=this.computeTestStatistic(bestVariantID,variantID);var criticalValue=this.computeCriticalValue(bestVariantID,variantID,critChi);if(testStatistic>criticalValue){continue}else{result={hasWinner:false,hasEnoughData:true,winnerID:null,winnerName:null};return result}}}result={hasWinner:true,hasEnoughData:true,winnerID:bestVariantID,winnerName:this._variants[bestVariantID]["name"]};return result};Confidence.prototype.computeTestStatistic=function(bestVariantID,challengerVariantID){var bestVariantRate=this.getRate(bestVariantID);var challengerVariantRate=this.getRate(challengerVariantID);var testStatistic=Math.abs(bestVariantRate-challengerVariantRate);return testStatistic};Confidence.prototype.computeCriticalValue=function(bestVariantID,challengerVariantID,critChi){var bestVariantRate=this.getRate(bestVariantID);var challengerVariantRate=this.getRate(challengerVariantID);var bestVariantTotal=this._variants[bestVariantID].eventCount;var challengerVariantTotal=this._variants[challengerVariantID].eventCount;var bestVariantPart=bestVariantRate*(1-bestVariantRate)/bestVariantTotal;var challengerVariantPart=challengerVariantRate*(1-challengerVariantRate)/challengerVariantTotal;var criticalValue=Math.sqrt(critChi)*Math.sqrt(bestVariantPart+challengerVariantPart);return criticalValue};return Confidence})},{}]},{},[1])(1)});