<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>PRISMA V2</title>
<link rel="icon" href="/static/img/favicon.png" type="image/png">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css" />

<link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/@mdi/font@4.x/css/materialdesignicons.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">

<style>
html, body {
    width: 100%;
    height: 100%;
    padding: 0;
    margin: 0;
    overflow: hidden;
}
body {
    font-size: 12px;
    font-family: Arial, Helvetica, sans-serif;
}
p {
    margin: .1rem;
}
a {
    color: #333333;
    text-decoration: none;
}
.d-flex {
    display: flex;
}
.flex-container {
    display: flex;
    justify-content: flex-start;
    width: 100%;
    height: 100%;
}
.box {
    display: flex;
    flex-direction: column;
    width: 100%;
}
.box-header {
    width: 100%;
    padding: 3px 0;
    display: flex;
    flex-direction: row;
}
.box-header a {
    font-size: .8em;
}
.box-header h4 {
    padding: 0;
    margin: 0;
    font-size: .95em;
    height: 1.6em;
    line-height: 1.6em;
    margin: 3px 0;
}
.box-header button, 
.box-body button, 
.box-footer button {
    height: 1.6em;
    line-height: 1em;
    font-size: .8em;
    margin: 4px;
}
.box-header input,
.box-body input {
    height: 1em;
    line-height: 1em;
    font-size: 1em;
    margin: 4px 4px 0 4px;
}
.box-header select {
    height: 1.6em;
    line-height: 1.2em;
    font-size: .8em;
    margin: 4px;
}
.box-header p {
    height: 1.6em;
    line-height: 1.2em;
    font-size: 1em;
    margin: 5px 0 0 2px;
}
.box-header span {
    font-size: .9em;
}
.box-header-right {
    font-size: .95em;
    height: 1.6em;
    line-height: 1.6em;
    margin: 3px 0;
    text-align: right;
}
.box-header a {
    padding: 1px 3px;
    margin: 0 5px;
    height: 1.6em;
    line-height: 1.6em;
}
.box-header a:hover {
    text-decoration: underline;
}
.box-body {
    width: 100%;
}
.box-body-item {
    padding: 5px 0 5px 0;
    display: flex;
    flex-direction: column;
    border-bottom: 1px dotted #cccccc;
}
/* for left - right items */
.box-body-item-left {
    width: 73%;
}
.box-body-item-right {
    width: 24%;
    display: flex;
    flex-direction: row;
}
.box-body-item-label {
    width: 54%;
    font-size: .9em;
    line-height: 1.8em;
}
.box-body-item-value {
    width: 45%;
}
.box-body-item select {
    width: 100%;
}
/* the label values items */
.bbi-label {
    width: 100%;
    padding: 0 0 3px 0;
    font-size: .8em;
    color: #666666;
    /* just for using the question marks */
    justify-content: space-between;
}
.bbi-value {
    width: 100%;
    padding: 2px 0px 2px 10px;
    font-size: .9em;
    color: #000000;
}
.bbi-label-hint {
    color: #999999;
    cursor: help;
}
.bbi-label-hint:hover {
    color: #333333;
}
.box-body h5 {
    padding: 0;
    margin: 0;
    font-size: .95em;
    height: 1.6em;
    line-height: 1.6em;
    margin: 3px 0;
}
.box-p {
    width: 100%;
    padding: 0;
    margin: 0;
    font-size: .9em;
}
.box-p-fixlen {    
    white-space: nowrap;
    text-overflow:ellipsis;
    overflow: hidden;
}
.box-footer {
    width: 100%;
    min-height: 20px;
    padding: 5px 0 5px 0;
}
.footer {
    width: 100%;
    align-items: flex-end;
    font-size: .75em;
    line-height: 1.5em;
    height: 1.5em;
}
.footer div {
    height: 1em;
    line-height: 1em;
}
.footer-link a {
    padding: 0 5px;
    color: #999999;
}

/* element ui css */
.text-start {
    font-size: 10px;
}
.v-data-table td {
    font-size: .8rem;
}
/* layouts */
#wrapper {
    flex-direction: row;
}
#start-screen {
    width: 100%;
    height: 100%;
    z-index: 9999;
    background: white;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}
#ss-msg {
    width: 100%;
    padding: 10px 0;
    text-align: center;
}
/* page */
.ss-box {
    position: absolute;
    width: 150px;
    /* height: 50px; */
    border: 1px solid #666666;
    padding: 5px;
    text-align: center;
    box-shadow: 3px 3px #cccccc;
    cursor: pointer;
    background-color: white;
}
.ss-box2 {
    border: 1px solid #ab7e3b;
    background-color: #fff9dc;
}
.ss-box2:hover {
    background: #fff9dc;
    box-shadow: 3px 3px #aaaaaa;
}
.ss-box3 {
    border-radius: 10px;
    border: 3px solid red;
}
.ss-info {
    /* max-height: 32px; */
    line-height: 15px;
    text-overflow: ellipsis;
    overflow: hidden;
}
.ss-box-stage {
    font-weight: normal;
}
.ss-box-stage:hover {
    font-weight: bold;
}
.ss-number {
    font-size: .9rem;
}
.ss-arrow {
    position: absolute;
    text-align: center;
    font-size: 2rem;
}
.ss-box-legend-text {
    margin-left: 30px;
    line-height: 10px;
    font-size: 11px;
    white-space: nowrap;
}
/* component */
.result-list-item {
    margin-bottom: 5px;
}
.result-list-item:hover,
.result-list-item:active {
    background-color: #eeeeee;
}
.study-badge {
    color: white;
    background: #6762df;
    padding: 0px 3px;
    border-radius: 5px;
}
.study-title {
    font-size: 1.1em;
    padding: 0 0 0 .2em;
    color: mediumblue;
}
.study-title:hover {
    color: blue;
}
.study-authors {
    padding: 0 0 0 .2em;
    font-size: .95em;
}
.study-pub {
    padding: 0 0 0 .2em;
    font-size: .9em;
}
.study-journal {
    font-weight: bold;
}
.study-pmid {
    color: gray;
}
.study-pmid:hover {
    color: darkblue;
    text-decoration: none;
}
.dialog p {
    font-size: 14px;
}
</style>
</head>
<body>

<div id="start-screen">
    <h1>
        <i class="fa fa-table"></i>
        PRISMA Flow Diagram
    </h1>
    <div id="ss-msg">Table Initializing ...</div>
</div>

<div id="wrapper" class="flex-container">

<div id="fg-prisma" class="box" style="width: 580px; min-width: 580px;">

    <div class="box-body" style="width: 100%; height:100%; position: relative;">

        <div class="ss-box" style="left: 15px; top: 10px; cursor: default;">
            <div class="ss-info">{{ vals.b1.text }}</div>
            <div class="ss-number">(n = {{ fmt_num(vals.b1.n_pmids) }})</div>
        </div>

        <div class="ss-box" style="left: 190px; top: 10px; cursor: default;">
            <div class="ss-info">{{ vals.b2.text }}</div>
            <div class="ss-number">(n = {{ fmt_num(vals.b2.n_pmids) }})</div>
        </div>

        <div class="ss-box" style="left: 15px; top: 110px; width: 300px !important; cursor: default;">
            <div class="ss-info">{{ vals.b3.text }}</div>
            <div class="ss-number">(n = {{ fmt_num(vals.b3.n_pmids) }})</div>
        </div>
        
        <div class="ss-box" style="left: 85px; top: 195px; cursor: default;">
            <div class="ss-info">{{ vals.b4.text }}</div>
            <div class="ss-number">(n = {{ fmt_num(vals.b4.n_pmids) }})</div>
        </div>

        <div class="ss-box" style="left: 85px; top: 300px; cursor: default;">
            <div class="ss-info">{{ vals.b5.text }}</div>
            <div class="ss-number">(n = {{ fmt_num(vals.b5.n_pmids) }})</div>
        </div>

        <div class="ss-box ss-box2 ss-box-stage" style="left: 85px; top: 400px;" v-on:click="update_study_list('b6')">
            <div class="ss-info">{{ vals.b6.text }}</div>
            <div class="ss-number">(n = {{ fmt_num(vals.b6.number) }})</div>
        </div>

        <div class="ss-box ss-box2 ss-box-stage" style="left: 85px; top: 500px;" v-on:click="update_study_list('b7')">
            <div class="ss-info">{{ vals.b7.text }}</div>
            <div class="ss-number">(n = {{ fmt_num(vals.b7.number) }})</div>
        </div>
        
        <!-- Exclude Part -->
        <div class="ss-box" style="left: 255px; top: 230px; width: 100px; cursor: default;">
            <div class="ss-info">{{ vals.e1.text }}</div>
            <div class="ss-number">(n = {{ fmt_num(vals.e1.n_pmids) }})</div>
        </div>

        <div class="ss-box ss-box2 ss-box-stage" style="left: 255px; top: 330px; width: 100px;" v-on:click="show_excluded_studies('e2')">
            <div class="ss-info">{{ vals.e2.text }}</div>
            <div class="ss-number">(n = {{ fmt_num(vals.e2.n_pmids) }})</div>
        </div>

        <div class="ss-box ss-box2 ss-box-stage" style="left: 255px; top: 430px; width: 100px;" v-on:click="update_study_list('e3')">
            <div class="ss-info">{{ vals.e3.text }}</div>
            <div class="ss-number">(n = {{ fmt_num(vals.e3.number) }})</div>
        </div>

        <!-- LNMA Part -->
        <div class="ss-box ss-box2 ss-box3 ss-box-stage" style="left: 370px; top: 10px; border: 3px solid red;" v-on:click="update_study_list('a1')">
            <div class="ss-info">{{ vals.a1.text }}</div>
            <div class="ss-number">(n = {{ fmt_num(vals.a1.number) }})</div>
        </div>

        <div class="ss-box ss-box2 ss-box3" style="left: 370px; top: 355px;">
            <div class="ss-box-stage" v-on:click="update_study_list('a2')">
                <div class="ss-info">{{ vals.a2.text }}</div>
                <div class="ss-number">(n = {{ fmt_num(vals.a2.number) }})</div>
            </div>
            <div class="ss-box-stage" style="border-top: 1px solid black; margin-top: 5px; padding-top: 3px;"
                v-on:click="update_study_list('u1')">
                <div class="ss-info">{{ vals.u1.text }}</div>
                <div class="ss-number">(n = {{ fmt_num(vals.u1.number) }})</div>
            </div>
        </div>

        <div class="ss-box ss-box2 ss-box3" style="left: 370px; top: 490px; z-index: 10;">
            <div class="ss-box-stage" v-on:click="update_study_list('a3')">
                <div class="ss-info">{{ vals.a3.text }}</div>
                <div class="ss-number">(n = {{ fmt_num(vals.a3.number) }})</div>
            </div>
            <div class="ss-box-stage" style="border-top: 1px solid black; margin-top: 5px; padding-top: 3px;"
                v-on:click="update_study_list('u2')">
                <div class="ss-info">{{ vals.u2.text }}</div>
                <div class="ss-number">(n = {{ fmt_num(vals.u2.number) }})</div>
            </div>
        </div>

        <!-- Merge Part -->

        <div class="ss-box ss-box2 ss-box3 ss-box-stage" style="left: 236px; top: 625px; " v-on:click="update_study_list('f1')">
            <div class="ss-info">{{ vals.f1.text }}</div>
            <div class="ss-number">(n = {{ fmt_num(vals.f1.number) }})</div>
            <div class="ss-info">({{ fmt_num(vals.f1.n_pmids) }} references)</div>
        </div>

        <div class="ss-box ss-box2 ss-box3 ss-box-stage" style="left: 235px; top: 745px;" v-on:click="update_study_list('f2')">
            <div class="ss-info">{{ vals.f2.text }}</div>
            <div class="ss-number">(n = {{ fmt_num(vals.f2.number) }})</div>
            <div class="ss-info">({{ fmt_num(vals.f2.n_pmids) }} references)</div>
        </div>

        <!-- Legend Part -->
        <div class="ss-box" style="left: 15px; top: 730px; width: 30px; height: 20px;">
            <div class="ss-box-legend-text">Traditional process</div>
        </div>
        <div class="ss-box ss-box2" style="left: 15px; top: 760px; width: 30px; height: 20px;">
            <div class="ss-box-legend-text">Clickable with data</div>
        </div>
        <div class="ss-box ss-box3" style="left: 15px; top: 790px; width: 30px; height: 20px;">
            <div class="ss-box-legend-text" style="margin-top: -2px;">Automatic process</div>
        </div>

        <!-- Arrows -->
        <div class="ss-arrow" style="left: 90px; top: 75px;">
            <i class="fa fa-long-arrow-alt-down"></i>
        </div>

        <div class="ss-arrow" style="left: 250px; top: 75px;">
            <i class="fa fa-long-arrow-alt-down"></i>
        </div>

        <div class="ss-arrow" style="left: 160px; top: 160px;">
            <i class="fa fa-long-arrow-alt-down"></i>
        </div>

        <div class="ss-arrow" style="left: 160px; top: 260px;">
            <i class="fa fa-long-arrow-alt-down"></i>
        </div>

        <div class="ss-arrow" style="left: 160px; top: 365px;">
            <i class="fa fa-long-arrow-alt-down"></i>
        </div>

        <div class="ss-arrow" style="left: 160px; top: 465px;">
            <i class="fa fa-long-arrow-alt-down"></i>
        </div>

        <!-- Arrows for exclude -->
        <div class="ss-arrow" style="left: 215px; top: 255px;">
            <i class="fa fa-long-arrow-alt-right"></i>
        </div>

        <div class="ss-arrow" style="left: 215px; top: 360px;">
            <i class="fa fa-long-arrow-alt-right"></i>
        </div>

        <div class="ss-arrow" style="left: 215px; top: 460px;">
            <i class="fa fa-long-arrow-alt-right"></i>
        </div>

        <div class="ss-arrow" style="left: 370px; top: 255px;">
            <i class="fa fa-long-arrow-alt-left"></i>
        </div>

        <div class="ss-arrow" style="left: 370px; top: 325px;">
            <i class="fa fa-long-arrow-alt-left"></i>
        </div>

        <div class="ss-arrow" style="left: 370px; top: 455px;">
            <i class="fa fa-long-arrow-alt-left"></i>
        </div>

        <!-- Arrows for LNMA -->
        <div class="ss-arrow" style="width: 6px; left: 445px; top: 90px; border-top: 235px solid black;">
            <div style="margin-top: -5px; margin-left: -5px;">
                <i class="fa fa-long-arrow-alt-down"></i>
            </div>
        </div>

        <div class="ss-arrow" style="left: 440px; top: 456px;">
            <i class="fa fa-long-arrow-alt-down"></i>
        </div>

        <!-- Arrows for Merge -->
        <div class="ss-arrow" style="width: 282px; height: 40px; left: 166px; top: 564px; border-bottom: 5px solid black; border-left: 5px solid black; border-right: 5px solid black; position: relative; z-index:1;">
            <div style="position: absolute; left: 135px; bottom: -35px;">
                <i class="fa fa-long-arrow-alt-down"></i>
            </div>
        </div>

        <div class="ss-arrow" style="left: 305px; top: 713px;">
            <i class="fa fa-long-arrow-alt-down"></i>
        </div>

    </div>

</div><!-- /#fg-prisma -->

<div id="tb-studylist" class="box" style="width: calc(100%-580px); min-width: 500px;">

    <div class="box-header">
        <h4>
            <i class="fa fa-file"></i>
            Study List | 
        </h4>
        <div>
            <p>{{ prisma[stage].text }} (n = {{ prisma[stage].n_ctids }})</p>
        </div>
    </div>

    <div class="box-body" style="overflow-y: auto;"
        v-if="total > 0">
        <div class="box-body-item result-list-item"
            v-for="r, idx in studies">

            <div class="study-title" style="cursor: pointer;"
                v-bind:title="'[' + r.title + ']'"
                v-on:click="show_study_by_pmid(r.pmid)">
                <span class="study-badge">{{ idx + 1 }}</span>
                <span v-html="r.title"></span>
            </div>

            <div class="study-authors">
                {{ r.authors }}
            </div>

            <div class="study-pub">
                {{ r.date }} 
                <span class="study-journal" v-html="r.journal"></span>. 
                    
                <a class="study-pmid" target="_blank" title="Show in PubMed" 
                    v-bind:href="url.pubmed.view_pmid + r.pmid">{{ r.pmid }}</a>
                <a class="study-pmid" target="_blank" title="Show clinical trial detail" 
                    v-bind:href="url.ctgov.view_ct + r.ctid">{{ r.ctid }}</a>
            </div>

        </div>
    </div>

    <div class="box-footer" style="text-align: right; padding: 0 0 10px 0;">
        <div v-if="tp>1">
            <button class="btn"
                v-on:click="prev_page">
                <i class="fa fa-arrow-left"></i>
                Prev Page
            </button>
            <button class="btn"
                v-on:click="next_page">
                <i class="fa fa-arrow-right"></i>
                Next Page
            </button>
        </div>
    </div>
</div><!-- /#tbl_study -->

</div>
<div id="dialog-message-e2" class="dialog" title="Excluded by full text review">
    <p>
    Full-text articles excluded.
    </p>
</div>
<div style="display:none;" id="data_pub">
[[j|safe]]
</div>

<!-- use third party libs -->
<script src="/static/lib/jquery/jquery-3.4.1.min.js"></script>
<script src="/static/lib/jquery-ui/jquery-ui.min.js"></script>
<script src="/static/lib/vue.js/vue.min.js"></script>
<!-- D3.js -->
<script src="/static/lib/d3/d3.min.js"></script>
<script src="/static/lib/d3/d3-sankey.js"></script>
<!-- vuetify -->
<script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
<!-- chance.js -->
<script src="/static/lib/alasql/alasql.min.js"></script>
<!-- for IE -->
<script>
var isIE = /*@cc_on!@*/false || !!document.documentMode;
if (isIE) {
    document.getElementById('ss-msg').innerHTML = 'The functions used in this website require advanced web technologies, which are <b>NOT</b> supported by Internet Explorer<br>Try using Google Chrome, Apple Safari, Mozilla Firefox or other modern browsers.';
}
</script>
<script>
{% include "js/fg_prisma_v2.js" %}
{% include "js/tb_studylist_v2.js" %}

var jarvis = {
    data: null,
    url: {
        sel_pred: './hsra_pred',
        ctgov: {
            view_ct: 'https://clinicaltrials.gov/ct2/show/'
        },
        pubmed: {
            esearch: 'https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=pubmed',
            esummary: 'https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esummary.fcgi?db=pubmed',
            efetch: "https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=pubmed",
            view_pmid: 'https://www.ncbi.nlm.nih.gov/pubmed/?term='
        },
    },

    get_url_paramter: function(name) {
        name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        var results = regex.exec(location.search);
        return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    },

    init: function() {
        // for the message boxes
        $( ".dialog" ).dialog({
            autoOpen: false
        });

        var prj = jarvis.get_url_paramter('prj');

        $.get(
            '/pub/graphdata/' + prj + '/PRISMA.json',
            {ver: Math.random()},
            function(data) {
                console.log(data);
                fg_prisma.init(data);
                tb_studylist.init(data);

                // get all the pmid detail from PubMed
                tb_studylist.load();

                // update the e2 detail
                var e2_details = data.prisma.e2.detail;
                e2_details = '<p>'+e2_details+'</p>';
                $('#dialog-message-e2').html(e2_details);

                // OK!
                jarvis.ssmsg('Data loaded!');
                setTimeout('jarvis.ssclose();', 300);
            }, 'json'
        );

    },

    ssmsg: function(msg) {
        $('#ss-msg').html(msg);
    },

    ssclose: function() {
        $('#start-screen').hide();
    }
};

$(document).ready(function() {
    jarvis.init();
})
</script>
</body>
</html>